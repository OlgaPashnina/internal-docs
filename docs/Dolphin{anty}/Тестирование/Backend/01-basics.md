---
id: testing-backend-env
title: Окружение
---
# Окружение

## Об окружении

Основным требованием к проведению функциональных тестов бэкенда является возможность проводить тесты изолировано от любых production / staging окружений. 

То есть не быть привязанными ко внешним обстоятельствам - упал сервер БД, таблицы почистили, забыли вложить нужный .env с реквизитами подключений и т.д.

Это же позволяет испытывать определенную долю спокойствия при запуске тестов на удаленных машинах Gitlab CI / Github Actions.

## Запуск окружения

Тестовая среда поднимается в Docker. Одной командой:

```bash
composer serve:testing
```

Данная команда реализована внутри файла `composer.json`. Если заглянуть под капот, то команда на самом деле выполняет:

```bash
docker-compose -f docker/docker-compose.testing.yml down && \
  docker-compose -f docker/docker-compose.testing.yml up -d
```

Команда `down` здесь стоит на первом месте для того, чтобы остановить контейнеры бэкенда других окружений.

## Состав контейнеров

Обратим внимание на файл `docker/docker-compose.testing.yml`. В нем описываются три сервиса:

- **anty-backend-php-fpm-tests** - обработчик php-fpm
- **anty-backend-php-nginx-tests** - веб-сервер nginx
- **anty-backend-php-mysql-tests** - тестовая база данных

:::info
Для тестового окружения в качестве СУБД используется MariaDB, так как у MySQL отсутствуют официальные docker образы для платформы ARM (например, MacBook M1).
:::

## Переход в контейнер PHP

Для того, чтобы попасть в контейнер, из-под которого можно будет выполнять команды вроде `php artisan ...` или `composer ...`, следует выполнить:

```bash
docker exec -it anty-backend-php-fpm-tests bash
```

И ты сразу окажешься в нужной среде.
