---
id: testing-backend-auth
title: Авторизация API
---

# Авторизация API

Большинство запросов в тестах будет относится к роутам, по которым требуется авторизация через JWT токен.

## Базовые пользователи

Для удобства мы предопределяем в сидере пул пользователей в БД, которые сразу существуют и доступны к работе.

Посмотри на `UserSeeder.php`.

В нем мы определяем трех пользователей одной и той же команды, но с разными ролями.

## Запросы с JWT-токеном

В родительском классе `TestCase` определен метод `setUp`. В рамках этого метода проводится авторизация путем `POST /auth/login`, метод `authorizeUser()`. Затем полученные свежие и валидные JWT-токены кладутся в `protected` свойства родителя так, что они доступны в любом из файлов тестов.

Таким образом в любом файле теста тебе доступны три свойства пользователя:

- `$this->adminUser` - объект пользователя администратора
- `$this->teamleadUser` - объект пользователя тимлида
- `$this->regularUser` - объект пользователя обычного пользователя

Доступные свойства данных объектов описаны в DTO `database/mocks/Users/UserDto.php`.

Для авторизации нам важны два их них:

- `token` - JWT-токен пользователя
- `headers` - готовый массив заголовков с авторизацией для использования в HTTP запросах