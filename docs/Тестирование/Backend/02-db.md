---
id: testing-backend-db
title: Базы данных
---

# Базы данных

## Подключение

Если снова обратиться к файлу `docker/docker-compose.testing.yml`, то мы обнаружим, что контейнер с БД поднимается по простым реквизитам:

```
127.0.0.1:3306
root
123456
anty
```

## Философия

Тестовые данные:

- **Не должны быть на удаленном сервере**, чтобы не терять время на соединение. *Именно поэтому мы поднимаем локальный контейнер в `docker/docker-compose.testing.yml`.*
- **Должны быть на локально поднятом сервере**, чтобы никто не мог повредить / очистить их без твоего ведома. *Именно поэтому мы поднимаем локальный контейнер в `docker/docker-compose.testing.yml`.*
- **Должны быть CI-ready.** *Именно поэтому мы используем сидеры/фабрики.* *Именно поэтому мы поднимаем локальный контейнер в `docker/docker-compose.testing.yml`.*
- **Не должны вводиться вручную**. *Именно поэтому мы используем сидеры/фабрики.*
- Должно быть **легко восстановить**. *Именно поэтому мы используем сидеры/фабрики.*
- Потеря тестовых данных и/или всей тестовой БД **не должно влечь за собой последствий** для пользователей / других разработчиков. *Именно поэтому мы поднимаем локальный контейнер в `docker/docker-compose.testing.yml`.*


## Миграции

Перед началом тестов, а также после проведения большой пачки тестов, которые могут повлечь за собой изменения в первоначальном состоянии тестовых данных следует выполнять команду

```bash
php artisan migrate:fresh --seed
```

## Транзакции

Для того, чтобы оставить после выполнения очередного теста тестовые данные нетронутыми в родительском для всех тестов классе `TestCase` используется трейт `DatabaseTransactions`. 


## Сидеры

[Документация Laravel о сидерах](https://laravel.com/docs/8.x/seeding).

Сидеры - способ заполнить БД данными.

Заполнять данные можно двумя способами - вручную и массово.

Ручное заполнение данных требуется в моменте, когда содержание этих данных имеет значение. Например, при заполнении таблицы `users`, ведь в будущем по этим пользователям с высокой вероятностью необходимо будет авторизовываться. И поэтому будет иметь значение логин и пароль.

Массовое заполнение данные требуется в ситуациях, когда содержания данных не имеет большого значения. Например, наполнение таблиц `tags` или `comments`. Нам просто нужны хоть какие-то данные, чтобы, например, проверить роуты выдачи списков этих сущностей.

В реальности имеет место сочетание этих двух подходов. Возьмем в пример сущность тега, таблицу `tags`.

В целом нам нужен массив какого-то количества тегов, чтобы в первую очередь проверить выдачу их списка. 

Но с другой стороны, двигаясь дальше по бизнес-логике, перед нами может встать задача протестировать поиск по тегам. И в таком случае нам понадобится хотя бы один тег с предопределенным названием, чтобы поисковый запрос срабатывал в 100% случаев. В такой тест кейсе понадобится обратиться к ручному заполнению.

## Фабрики

[Документация Laravel о фабриках](https://laravel.com/docs/8.x/seeding#using-model-factories)

Фабрики - способ массового заполнения БД данными, содержание которых не имеет большого значения.